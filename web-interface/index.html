<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GBP/USD Trading System</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="container">
      <div class="header-inner">
        <div class="logo">
          <div class="logo-icon">üìà</div>
          <div>
            <h1>GBP/USD Trading System</h1>
            <span>COLNOT & M√âTOIS ‚Äî F√©vrier 2026</span>
          </div>
        </div>
        <div class="status-badge" id="healthBadge">
          <div class="status-dot"></div>
          <span id="healthStatus">Connexion API...</span>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <div class="container">
    <div class="hero">
      <div class="hero-label">Projet Fil Rouge ‚Äî M1 ‚Üí M15 ‚Üí ML ‚Üí RL ‚Üí API</div>
      <h2>Syst√®me de D√©cision<br><span>Algorithmique</span></h2>
      <p>Pipeline complet de trading GBP/USD : import M1, agr√©gation M15, feature engineering, analyse exploratoire, ML
        et Reinforcement Learning.</p>
    </div>

    <!-- PIPELINE VISUAL -->
    <div class="pipeline-section">
      <div class="section-title">// Pipeline de d√©cision</div>
      <div class="pipeline">
        <div class="pipeline-step" onclick="showPanel('import')">
          <div class="step-num">01</div>
          <div class="step-icon">üì•</div>
          <div class="step-name">Import M1</div>
          <div class="step-desc">Chargement CSV brut + timestamp + r√©gularit√© 1min</div>
          <span class="step-badge">T01</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('m15')">
          <div class="step-num">02‚Äì03</div>
          <div class="step-icon">‚öôÔ∏è</div>
          <div class="step-name">M15</div>
          <div class="step-desc">Agr√©gation OHLC + nettoyage (gaps, prix n√©gatifs)</div>
          <span class="step-badge">T02‚Äì03</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('features')">
          <div class="step-num">04</div>
          <div class="step-icon">üîß</div>
          <div class="step-name">Features V2</div>
          <div class="step-desc">20 features court terme + contexte & r√©gime</div>
          <span class="step-badge">T05</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('eda')">
          <div class="step-num">05</div>
          <div class="step-icon">üî¨</div>
          <div class="step-name">EDA</div>
          <div class="step-desc">ADF, ACF, distribution, volatilit√©, analyse horaire</div>
          <span class="step-badge">T04</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('baseline')">
          <div class="step-num">06</div>
          <div class="step-icon">üìè</div>
          <div class="step-name">Baseline</div>
          <div class="step-desc">Random, Buy & Hold, R√®gles fixes EMA+RSI</div>
          <span class="step-badge">T06</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('ml')">
          <div class="step-num">07</div>
          <div class="step-icon">ü§ñ</div>
          <div class="step-name">ML Trading</div>
          <div class="step-desc">LogReg / RF / GBM ‚Äî split 2022/2023/2024/2025</div>
          <span class="step-badge">T07</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('rl')">
          <div class="step-num">08</div>
          <div class="step-icon">üéÆ</div>
          <div class="step-name">RL</div>
          <div class="step-desc">Q-Learning ‚Äî state, action, reward, walk-forward</div>
          <span class="step-badge">T08</span>
        </div>
        <div class="pipeline-step" onclick="showPanel('evaluate')">
          <div class="step-num">09</div>
          <div class="step-icon">üèÜ</div>
          <div class="step-name">√âvaluation</div>
          <div class="step-desc">Comparaison toutes strat√©gies + stress tests 2024</div>
          <span class="step-badge">T09</span>
        </div>
      </div>
    </div>

    <!-- ACTIVE DATASET TRACKER -->
    <div class="panel" style="margin-bottom: 24px;">
      <div class="panel-header">
        <div class="panel-title">üìã Datasets en m√©moire</div>
        <button class="btn btn-secondary" style="font-size:11px;padding:6px 14px;"
          onclick="refreshDatasets()">Rafra√Æchir</button>
      </div>
      <div class="panel-body">
        <div class="form-grid" id="datasetTracker">
          <div style="color:var(--text-dim);font-size:12px;">Chargez un dataset pour commencer.</div>
        </div>
        <div style="font-size:11px;color:var(--text-dim);margin-top:8px;font-family:'IBM Plex Mono',monospace;">
          Copiez le dataset_id pour l'utiliser dans les autres panneaux.
        </div>
      </div>
    </div>

    <!-- PANELS -->
    <div id="panel-import" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üì• Phase 1 ‚Äî Import M1</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">POST
            /dataset/load_m1</span>
        </div>
        <div class="panel-body">
          <div class="info-row"><span class="icon">‚ÑπÔ∏è</span> Charge le CSV M1 brut (2022, 2023, 2024, 2025) depuis le
            dossier <code>data/</code>, fusionne Date+Time ‚Üí timestamp, v√©rifie la r√©gularit√© 1min.</div>
          <div class="separator"></div>
          <div class="form-grid">
            <div class="form-group">
              <label>Ann√©e</label>
              <select id="importYear">
                <option value="2022">2022 ‚Äî Entra√Ænement</option>
                <option value="2023">2023 ‚Äî Validation</option>
                <option value="2024">2024 ‚Äî Test final</option>
                <option value="2025">2025 ‚Äî Pr√©dictions suppl√©mentaires</option>
              </select>
            </div>
          </div>
          <div style="display:flex;gap:10px;">
            <button class="btn btn-primary" onclick="importM1()" id="btnImport">
              <span class="btn-text">Charger M1</span>
              <span class="loader"></span>
            </button>
          </div>
          <div class="separator"></div>
          <div class="output-area" id="out-import"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-m15" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">‚öôÔ∏è Phase 2‚Äì3 ‚Äî Agr√©gation & Nettoyage M15</div>
        </div>
        <div class="panel-body">
          <div class="tabs">
            <div class="tab active" onclick="setTab(this,'agg')">Agr√©gation M1‚ÜíM15</div>
            <div class="tab" onclick="setTab(this,'clean15')">Nettoyage M15</div>
          </div>
          <div id="tab-agg">
            <div class="info-row"><span class="icon">‚ÑπÔ∏è</span> Agr√®ge les bougies M1 ‚Üí M15 (open=first, high=max,
              low=min, close=last). Supprime les bougies incompl√®tes (&lt;15 points M1).</div>
            <div class="form-grid" style="margin-top:16px;">
              <div class="form-group">
                <label>Dataset ID (M1)</label>
                <input type="text" id="aggDatasetId" placeholder="ex: m1_2022_abc123">
              </div>
            </div>
            <button class="btn btn-primary" onclick="aggregateM15()" id="btnAgg">
              <span class="btn-text">Agr√©ger M1 ‚Üí M15</span>
              <span class="loader"></span>
            </button>
            <div class="separator"></div>
            <div class="output-area" id="out-agg"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
            </div>
          </div>
          <div id="tab-clean15" style="display:none;">
            <div class="info-row"><span class="icon">‚ÑπÔ∏è</span> Supprime bougies incompl√®tes, prix n√©gatifs, incoh√©rences
              OHLC, gaps anormaux (&gt;2%).</div>
            <div class="form-grid" style="margin-top:16px;">
              <div class="form-group">
                <label>Dataset ID (M15)</label>
                <input type="text" id="clean15DatasetId" placeholder="ex: m1_2022_abc123_m15">
              </div>
              <div class="form-group">
                <label>Seuil de gap (%)</label>
                <input type="number" id="gapThreshold" value="0.02" step="0.005" min="0.005" max="0.1">
              </div>
            </div>
            <button class="btn btn-primary" onclick="cleanM15()" id="btnClean15">
              <span class="btn-text">Nettoyer M15</span>
              <span class="loader"></span>
            </button>
            <div class="separator"></div>
            <div class="output-area" id="out-clean15"><span class="output-placeholder">// R√©sultat appara√Ætra
                ici‚Ä¶</span></div>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-features" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üîß Phase 4 ‚Äî Feature Engineering V2</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">POST
            /features/compute</span>
        </div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-group">
              <label>Dataset ID (M15 nettoy√©)</label>
              <input type="text" id="featDatasetId" placeholder="ex: m1_2022_abc_m15_clean">
            </div>
            <div class="form-group">
              <label>Ajouter target (y)</label>
              <select id="addTarget">
                <option value="true">Oui ‚Äî y=1 si close_t+1 > close_t</option>
                <option value="false">Non</option>
              </select>
            </div>
          </div>
          <button class="btn btn-primary" onclick="computeFeatures()" id="btnFeat">
            <span class="btn-text">Calculer les features</span>
            <span class="loader"></span>
          </button>
          <div class="separator"></div>
          <div style="margin-bottom:16px;">
            <div style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;margin-bottom:8px;">
              Features V2 disponibles :</div>
            <div style="display:flex;flex-wrap:wrap;gap:6px;" id="featureTagsDisplay">
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">return_1</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">return_4</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">ema_20</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">ema_50</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">ema_diff</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">rsi_14</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">rolling_std_20</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">atr_14</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">adx_14</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">macd</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">ema_200</span>
              <span
                style="font-size:10px;padding:3px 8px;background:rgba(0,212,255,0.08);border:1px solid rgba(0,212,255,0.2);border-radius:4px;font-family:'IBM Plex Mono',monospace;color:var(--accent)">+9
                autres</span>
            </div>
          </div>
          <div class="output-area" id="out-features"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-eda" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üî¨ Phase 5 ‚Äî Analyse Exploratoire (EDA)</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">GET
            /eda/full_report/{id}</span>
        </div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-group">
              <label>Dataset ID (M15)</label>
              <input type="text" id="edaDatasetId" placeholder="ex: m1_2022_abc_m15_clean">
            </div>
            <div class="form-group">
              <label>Type d'analyse</label>
              <select id="edaType">
                <option value="full_report">Rapport complet</option>
                <option value="returns">Distribution des rendements</option>
                <option value="volatility">Volatilit√© dans le temps</option>
                <option value="hourly">Analyse horaire</option>
                <option value="autocorrelation">Autocorr√©lation (ACF)</option>
                <option value="adf">Test ADF (stationnarit√©)</option>
              </select>
            </div>
          </div>
          <button class="btn btn-primary" onclick="runEDA()" id="btnEDA">
            <span class="btn-text">Lancer l'analyse</span>
            <span class="loader"></span>
          </button>
          <div class="separator"></div>

          <!-- Zone Graphiques EDA -->
          <div id="edaChartsArea" style="display:none;">
            <div class="charts-grid">
              <div class="chart-container">
                <canvas id="chartReturns"></canvas>
              </div>
              <div class="chart-container">
                <canvas id="chartVolatility"></canvas>
              </div>
              <div class="chart-container">
                <canvas id="chartHourly"></canvas>
              </div>
              <div class="chart-container">
                <canvas id="chartACF"></canvas>
              </div>
            </div>
            <div class="separator"></div>
          </div>

          <div class="output-area" id="out-eda"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-baseline" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üìè Phase 6 ‚Äî Strat√©gies Baseline</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">GET
            /baseline/compare/{id}</span>
        </div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-group">
              <label>Dataset ID (M15)</label>
              <input type="text" id="baselineDatasetId" placeholder="ex: m1_2022_abc_m15_clean">
            </div>
            <div class="form-group">
              <label>Seed (al√©atoire)</label>
              <input type="number" id="baselineSeed" value="42">
            </div>
          </div>
          <button class="btn btn-primary" onclick="runBaseline()" id="btnBaseline">
            <span class="btn-text">Comparer les baselines</span>
            <span class="loader"></span>
          </button>
          <div class="separator"></div>
          <div id="baselineTable"></div>
          <div class="output-area" id="out-baseline"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-ml" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">ü§ñ Phase 7 ‚Äî Machine Learning Trading</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">POST
            /trading_ml/train</span>
        </div>
        <div class="panel-body">
          <div class="info-row"><span class="icon">‚ö†Ô∏è</span>
            Split temporel strict obligatoire : Train=2022 / Val=2023 / Test=2024 / Test_supp=2025</div>
          <div class="form-grid" style="margin-top:16px;">
            <div class="form-group">
              <label>Dataset Train (2022 + features)</label>
              <input type="text" id="mlTrainId" placeholder="ex: m1_2022_abc_m15_clean_features">
            </div>
            <div class="form-group">
              <label>Dataset Val (2023 + features)</label>
              <input type="text" id="mlValId" placeholder="ex: m1_2023_abc_m15_clean_features">
            </div>
            <div class="form-group">
              <label>Dataset Test (2024, optionnel)</label>
              <input type="text" id="mlTestId" placeholder="ex: m1_2024_abc_m15_clean_features">
            </div>
            <div class="form-group">
              <label>Dataset Test_supp (2025, optionnel)</label>
              <input type="text" id="mlTestSuppId" placeholder="ex: m1_2025_abc_m15_clean_features">
            </div>
            <div class="form-group">
              <label>Mod√®le</label>
              <select id="mlModelType">
                <option value="rf">RandomForest (v2 ‚Äî recommand√©)</option>
                <option value="logreg">LogisticRegression (v1)</option>
                <option value="gbm">GradientBoosting (v3)</option>
              </select>
            </div>
          </div>
          <button class="btn btn-primary" onclick="trainML()" id="btnML">
            <span class="btn-text">Entra√Æner le mod√®le</span>
            <span class="loader"></span>
          </button>
          <div class="separator"></div>
          <div class="output-area" id="out-ml"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span></div>
        </div>
      </div>
    </div>

    <div id="panel-rl" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üéÆ Phase 8 ‚Äî Reinforcement Learning</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">POST
            /rl/train</span>
        </div>
        <div class="panel-body">
          <div class="tabs">
            <div class="tab active" onclick="setTab(this,'rl-train')">Entra√Ænement</div>
            <div class="tab" onclick="setTab(this,'rl-design')">Conception (9.1)</div>
          </div>
          <div id="tab-rl-train">
            <div class="form-grid">
              <div class="form-group">
                <label>Dataset Train (2022 + features)</label>
                <input type="text" id="rlTrainId" placeholder="ex: m1_2022_abc_m15_clean_features">
              </div>
              <div class="form-group">
                <label>Dataset Val (2023 + features)</label>
                <input type="text" id="rlValId" placeholder="ex: m1_2023_abc_m15_clean_features">
              </div>
              <div class="form-group">
                <label>Nombre d'√©pisodes</label>
                <input type="number" id="rlEpisodes" value="10" min="1" max="100">
              </div>
              <div class="form-group">
                <label>Seed</label>
                <input type="number" id="rlSeed" value="42">
              </div>
            </div>
            <button class="btn btn-primary" onclick="trainRL()" id="btnRL">
              <span class="btn-text">Entra√Æner l'agent Q-Learning</span>
              <span class="loader"></span>
            </button>
            <div class="separator"></div>

            <!-- Graphique Entra√Ænement RL -->
            <div class="chart-container" id="rlChartContainer" style="display:none;">
              <canvas id="chartRLTraining"></canvas>
            </div>
            <div class="separator" id="rlChartSeparator" style="display:none;"></div>

            <div class="output-area" id="out-rl"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
            </div>
          </div>
          <div id="tab-rl-design" style="display:none;">
            <button class="btn btn-secondary" onclick="getRLDesign()" style="margin-bottom:16px;" id="btnRLDesign">
              <span class="btn-text">Afficher la conception (section 9.1)</span>
              <span class="loader"></span>
            </button>
            <div class="output-area" id="out-rl-design"><span class="output-placeholder">// Conception obligatoire sur
                papier‚Ä¶</span></div>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-evaluate" class="panel-section" style="display:none;">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">üèÜ Phase 9 ‚Äî √âvaluation Finale</div>
          <span style="font-size:11px;color:var(--text-dim);font-family:'IBM Plex Mono',monospace;">GET
            /evaluate/compare/{id}</span>
        </div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-group">
              <label>Dataset Test 2024 (avec features)</label>
              <input type="text" id="evalDatasetId" placeholder="ex: m1_2024_abc_m15_clean_features">
            </div>
            <div class="form-group">
              <label>ML Model ID (optionnel)</label>
              <input type="text" id="evalMLId" placeholder="Laisser vide pour meilleur mod√®le">
            </div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="runEvaluation()" id="btnEval">
              <span class="btn-text">Comparer toutes les strat√©gies</span>
              <span class="loader"></span>
            </button>
            <button class="btn btn-secondary" onclick="runStressTest()" id="btnStress">
              Stress test trimestriel
            </button>
          </div>
          <div class="separator"></div>

          <!-- Zone Graphique √âvaluation -->
          <div class="chart-container" id="evalChartContainer" style="display:none;">
            <canvas id="chartEval"></canvas>
          </div>
          <div class="separator"></div>

          <div id="evalTable"></div>
          <div class="output-area" id="out-eval"><span class="output-placeholder">// R√©sultat appara√Ætra ici‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /container -->

  <!-- TOAST -->
  <div class="toast" id="toast">
    <span id="toastIcon">‚úÖ</span>
    <span id="toastMsg"></span>
  </div>

  <footer>
    <div class="container">
      GBP/USD Trading System v2.0 ‚Äî COLNOT & M√âTOIS ‚Äî Projet Data Science M1 ‚Äî 2026
    </div>
  </footer>

  <script src="js/api.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/charts.js"></script>
  <script src="js/app.js"></script>

</body>

</html>